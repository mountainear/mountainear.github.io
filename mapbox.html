<!DOCTYPE html>
<html lang="de">

<head>
    <!-- Mapbox Kartenscript-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <!-- Mapbox Stylesheet -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <title>mountainear</title>
    <!-- Marker jsons -->
    <script src='skigebiete.json'></script>

</head>

<body>

    <header>
        <h1>MOUNTAI<b>NEAR</b> - access the mountains close to you by public transport</h1>
    </header>



    <main>
        <style>
            .mapboxgl-popup {
                max-width: 200px;
            }

            .marker {
                background-image: url('icons/activity/snowflake.png');
                background-size: cover;
                width: 20px;
                height: 20px;
                cursor: pointer
            }

            .markerSkigebiete {
                background-image: url('icons/activity/hiking.svg');
                background-size: cover;
                width: 20px;
                height: 20px;
                cursor: pointer
            }
        </style>
        <div id='map' style='width: 100%; height: 100vh;'></div>
        <script>
            mapboxgl.accessToken =
                'pk.eyJ1IjoiaGFubmE4YnIiLCJhIjoiY2tpYWNudXViMGhscDJ5cmtxOTliZDl0NSJ9.KIYizFkjQ7ODuRfxwFBEtg';
            var map = new mapboxgl.Map({
                container: 'map', // container ID
                style: 'mapbox://styles/hanna8br/ckr3mc3gnes5h18mkuzxtvxwn', // style URL
                center: [13.34290, 47.71216], // starting position [lng, lat]
                zoom: 6.5, // starting zoom
                attributionControl: false
            });
            map.addControl(new mapboxgl.AttributionControl({
                compact: true,
                customAttribution: "mountainear"
            }));
            // Fullscreen control
            map.addControl(new mapboxgl.FullscreenControl({
                container: document.querySelector('body')
            }));
            // Navigation control
            var nav = new mapboxgl.NavigationControl({
                showCompass: true,
                showZoom: true,
                visualizePitch: true
            });
            map.addControl(nav, 'top-left');
            // Scale control
            var scale = new mapboxgl.ScaleControl({
                maxWidth: 80,
                unit: 'imperial'
            });
            map.addControl(scale);

            scale.setUnit('metric');
            // Geolocate control
            // Initialize the geolocate control.
            var geolocate = new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true,
                fitBoundsOptions: {
                    maxZoom: 10
                }
            });
            // Move map to user's location
            // Add the control to the map.
            map.addControl(geolocate);
            /* map.on('load', function () {
                geolocate.trigger();
            }); */
            // Set an event listener that fires
            // when an error event occurs.
            geolocate.on('error', function () {
                console.log('An error event has occurred.')
            });

            // Markers & Layers
            // Set options
            var marker = new mapboxgl.Marker({
                    color: "#265172",
                    draggable: false
                }).setLngLat([13.34290, 47.71216])
                .setPopup(new mapboxgl.Popup().setHTML("Hello World!")) // add popup
                .addTo(map);

            var graz = new mapboxgl.Marker({
                    color: "#EAD157"
                }).setLngLat([15.434577437484505, 47.074503588984115])
                .setPopup(new mapboxgl.Popup().setHTML("home of mountainear"))
                .addTo(map);

            marker.togglePopup(); // toggle popup open or closed


            /// ADD DATA ///
            var geojson = {
                'type': 'FeatureCollection',
                'features': [{
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': [15, 47]
                        },
                        'properties': {
                            'title': 'Skigebiet hier',
                            'description': 'hierhierhier'
                        }
                    },
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': [15.5, 47.5]
                        },
                        'properties': {
                            'title': 'Skigebiet da',
                            'description': 'dadada'
                        }
                    }
                ]
            };


            // add markers to map
            geojson.features.forEach(function (marker) {
                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker';

                // make a marker for each feature and add it to the map
                new mapboxgl.Marker(el)
                    .setLngLat(marker.geometry.coordinates)
                    .setPopup(
                        new mapboxgl.Popup({
                            offset: 25
                        }) // add popups
                        .setHTML(
                            '<h3>' +
                            marker.properties.title +
                            '</h3><p>' +
                            marker.properties.description +
                            '</p>'
                        )
                    )
                    .addTo(map);
            });


            map.on('load', function () {
                map.addSource('skigebiete', {
                    'type': 'geojson',
                    'data': 'skigebiete.geojson'
                });

                map.addLayer({
                    'id': 'skigebiete-layer',
                    'type': 'circle',
                    'source': 'skigebiete',
                    'paint': {
                        'circle-radius': 8,
                        'circle-stroke-width': 8,
                        'circle-color': 'red',
                        'circle-stroke-color': 'white',

                    }
                });

                var mySource = map.getSource('some id');


                // add markers to map
                mySource.forEach(function (marker) {

                    // create a HTML element for each feature
                    var el = document.createElement('div');
                    el.className = 'markerSkigebiete';

                    // make a marker for each feature and add to the map
                    new mapboxgl.Marker(el)
                        .setLngLat(marker.geometry.coordinates)
                        .addTo(map);
                });

            });

            map.on('layeradd', function (e) {
                var marker = e.layer,
                    feature = 'skigebiete.geojson';
                marker.setIcon('icons/activity/hiking.svg');
            });
            map.setGeoJSON('skigebiete.geojson');
        </script>



    </main>

    <hr>

    <footer>
        <br>
        (c) mountai<b>near</b> 2021
    </footer>

</body>

</html>